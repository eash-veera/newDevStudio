!function(e){"use strict";var i=e.module("lfNgMdFileInput",["ngMaterial"]);i.filter("lfTrusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),i.directive("lfNgMdFileInput",["$q","$compile","$timeout",function(i,l,n){return{restrict:"E",template:['<div layout="column" class="lf-ng-md-file-input">','<div layout="column" class="lf-ng-md-file-input-preview-container" ng-class="{\'disabled\':isDisabled}" ng-show="isDrag || (isPreview && !isFilesNull)">','<div class="close lf-ng-md-file-input-x" ng-click="removeAllFiles($event)" ng-hide="isFilesNull" >&times;</div>','<div class="lf-ng-md-file-input-drag">','<div layout="row" layout-align="center center" class="lf-ng-md-file-input-drag-text-container" ng-show="isFilesNull && isDrag">','<div class="lf-ng-md-file-input-drag-text">{{strCaptionDragAndDrop}}</div>',"</div>",'<div class="lf-ng-md-file-input-thumbnails">',"</div>",'<div class="clearfix" style="clear:both"></div>',"</div>","</div>",'<div layout="row" class="lf-ng-md-file-input-container" >','<div class="lf-ng-md-file-input-caption" layout="row" layout-align="start center" flex ng-class="{\'disabled\':isDisabled}" >','<md-icon class="lf-icon" ng-class="strCaptionIconCls"></md-icon>','<div flex class="lf-ng-md-file-input-caption-text-default" ng-show="isFilesNull">',"{{strCaptionPlaceholder}}","</div>",'<div flex class="lf-ng-md-file-input-caption-text" ng-hide="isFilesNull">',"{{strCaption}}","</div>","</div>",'<md-button ng-disabled="isDisabled" ng-click="removeAllFiles()" ng-hide="isFilesNull" class="md-raised lf-ng-md-file-input-button lf-ng-md-file-input-button-remove" >','<md-icon class="lf-icon" ng-class="strRemoveIconCls"></md-icon> ',"{{strCaptionRemove}}","</md-button>",'<md-button ng-disabled="isDisabled" ng-click="openDialog($event, this)" class="md-raised md-primary lf-ng-md-file-input-button lf-ng-md-file-input-button-brower" >','<md-icon class="lf-icon" ng-class="strBrowseIconCls"></md-icon> ',"{{strCaptionBrowse}}",'<input type="file" accept="{{accept}}" ng-disabled="isDisabled" class="lf-ng-md-file-input-tag" onchange="angular.element(this).scope().onFileChanged(this)"/>',"</md-button>","</div>","</div>"].join(""),replace:!0,scope:{lfFiles:"=?",lfApi:"=?",lfOption:"=?",lfPlaceholder:"@?",lfDragAndDropLabel:"@?",lfBrowseLabel:"@?",lfRemoveLabel:"@?",accept:"@?",ngDisabled:"=?"},link:function(t,o,s){var a=e.element(o[0].querySelector(".lf-ng-md-file-input-tag")),r=e.element(o[0].querySelector(".lf-ng-md-file-input-drag")),f=e.element(o[0].querySelector(".lf-ng-md-file-input-thumbnails"));t.isPreview=!1,t.isDrag=!1,t.isMutiple=!1,"preview"in s&&(t.isPreview=!0),"drag"in s&&(t.isDrag=!0),"multiple"in s?(a.attr("multiple","multiple"),t.isMutiple=!0):a.removeAttr("multiple"),t.isDisabled=!1,e.isDefined(s.ngDisabled)&&t.$watch(function(){return t.ngDisabled},function(e){t.isDisabled=e}),t.strBrowseIconCls="lf-browse",t.strRemoveIconCls="lf-remove",t.strCaptionIconCls="lf-caption",t.strUnknowIconCls="lf-unknow",e.isDefined(s.lfOption)&&e.isObject(t.lfOption)&&(t.lfOption.hasOwnProperty("browseIconCls")&&(t.strBrowseIconCls=t.lfOption.browseIconCls),t.lfOption.hasOwnProperty("removeIconCls")&&(t.strRemoveIconCls=t.lfOption.removeIconCls),t.lfOption.hasOwnProperty("captionIconCls")&&(t.strCaptionIconCls=t.lfOption.captionIconCls),t.lfOption.hasOwnProperty("unknowIconCls")&&(t.strUnknowIconCls=t.lfOption.unknowIconCls)),t.accept=t.accept||"",t.lfFiles=[],t.lfApi=new function(){var e=this;e.removeAll=function(){t.removeAllFiles()}},t.isFilesNull=!0,t.strCaption="",t.strCaptionPlaceholder="Select file",t.strCaptionDragAndDrop="Drag & drop files here...",t.strCaptionBrowse="Browse",t.strCaptionRemove="Remove",t.lfPlaceholder&&(t.strCaptionPlaceholder=t.lfPlaceholder),t.lfDragAndDropLabel&&(t.strCaptionDragAndDrop=t.lfDragAndDropLabel),t.lfBrowseLabel&&(t.strCaptionBrowse=t.lfBrowseLabel),t.lfRemoveLabel&&(t.strCaptionRemove=t.lfRemoveLabel),r.bind("dragover",function(e){e.stopPropagation(),e.preventDefault(),!t.isDisabled&&t.isDrag&&r.addClass("lf-ng-md-file-input-drag-hover")}),r.bind("dragleave",function(e){e.stopPropagation(),e.preventDefault(),!t.isDisabled&&t.isDrag&&r.removeClass("lf-ng-md-file-input-drag-hover")}),r.bind("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!t.isDisabled&&t.isDrag){r.removeClass("lf-ng-md-file-input-drag-hover");var i,l=e.target.files||e.dataTransfer.files,n=0;if(!(l.length<=0)){var o=t.lfFiles.map(function(e){return e.lfFileName}),s=new RegExp(t.accept,"i");if(t.isMutiple)for(n=0;n<l.length;n++)i=l[n],i.type.match(s)&&-1==o.indexOf(i.name)&&setTimeout(c(i),100*n);else for(n=0;n<l.length;n++)if(i=l[n],i.type.match(s)&&-1==o.indexOf(i.name)){t.removeAllFiles(),setTimeout(c(i),100*n);break}}}}),t.openDialog=function(e,i){-1!=navigator.userAgent.indexOf("Firefox")&&e&&n(function(){e.preventDefault(),e.stopPropagation();var i=e.target.children[2];void 0!==i&&i.click()},0)},t.removeAllFiles=function(e){t.isDisabled||(t.lfFiles=[],f.empty(),d())},t.removeFileByName=function(i,l){t.isDisabled||(t.lfFiles.every(function(e,l){return e.lfFileName==i?(t.lfFiles.splice(l,1),!1):!0}),l&&e.element(l.target).parent().remove(),d())},t.onFileChanged=function(e){var i=e.files,l=t.lfFiles.map(function(e){return e.lfFileName});if(!(i.length<=0)){if(t.isMutiple)for(var n=0;n<i.length;n++){var o=i[n],s=1;-1==l.indexOf(o.name)&&(setTimeout(c(o),100*s),s++)}else for(var n=0;n<i.length;n++){var o=i[n];if(-1==l.indexOf(o.name)){t.removeAllFiles(),setTimeout(c(o),100);break}}a.val("")}};var c=function(i){v(i).then(function(n){var o=i,s=i.name,a=i.type,r=u(i),c=window.URL.createObjectURL(i);t.lfFiles.push({lfFile:o,lfFileName:s,lfDataUrl:c});var p=e.element('<div class="lf-ng-md-file-input-frame"></div>'),m=e.element('<div class="lf-ng-md-file-input-x" ng-click="removeFileByName(\''+i.name+"',$event)\">&times;</div>"),g="";g="image"==r?'<img src="'+c+'" >':"video"==r?["<video controls>",'<source src="'+c+'" type="'+a+'">',"</video>"].join(""):"audio"==r?["<audio controls>",'<source src="'+c+'" type="'+a+'">',"</audio>"].join(""):['<object data="'+c+'" type="'+a+'"><param name="movie" value="'+o.name+'" />','<div class="lf-ng-md-file-input-preview-default">','<md-icon class="lf-ng-md-file-input-preview-icon" ng-class="strUnknowIconCls"></md-icon>',"</div>","</object>"].join("");var v=e.element(g),b=e.element('<div class="lf-ng-md-file-input-frame-footer"><div class="lf-ng-md-file-input-frame-caption">'+o.name+"</div></div>");p.append(m),p.append(v),p.append(b),l(p)(t),f.append(p),d()},function(e){},function(e){})},d=function(){1==t.lfFiles.length?(t.strCaption=""+t.lfFiles[0].lfFileName,t.isFilesNull=!1):t.lfFiles.length>1?(t.strCaption=""+t.lfFiles.length+" files selected",t.isFilesNull=!1):(t.strCaption="",t.isFilesNull=!0)},u=function(e){var i=e.type,l=e.name;return p(i,l)?"image":m(i,l)?"video":g(i,l)?"audio":"object"},p=function(e,i){return e.match("image.*")||i.match(/\.(gif|png|jpe?g)$/i)?!0:!1},m=function(e,i){return e.match("video.*")||i.match(/\.(og?|mp4|webm|3gp)$/i)?!0:!1},g=function(e,i){return e.match("audio.*")||i.match(/\.(ogg|mp3|wav)$/i)?!0:!1},v=function(e,l){var n=i.defer(),t=new FileReader;return t.onloadstart=function(){n.notify(0)},t.onload=function(e){},t.onloadend=function(e){n.resolve({index:l,result:t.result})},t.onerror=function(e){n.reject(t.result)},t.onprogress=function(e){n.notify(e.loaded/e.total)},t.readAsArrayBuffer(e),n.promise}}}}])}(window.angular);